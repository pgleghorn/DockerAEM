FROM centos
MAINTAINER pgleghorn@gmail.com

ARG AEM_JAR
ARG AEM_LICENSE
ARG AEM_DIR
ARG AEM_USER

ENV AEM_JAR $AEM_JAR
ENV AEM_LICENSE $AEM_LICENSE
ENV AEM_DIR $AEM_DIR
ENV AEM_USER $AEM_USER

ENV CQ_NOBROWSER y

WORKDIR $AEM_DIR

COPY $AEM_JAR $AEM_DIR
COPY $AEM_LICENSE $AEM_DIR

RUN yum install -y java
RUN yum clean all
RUN groupadd -r $AEM_USER && useradd -r -g $AEM_USER $AEM_USER -d $AEM_DIR
RUN java -jar $AEM_DIR/$AEM_JAR -unpack
RUN chown -R $AEM_USER:$AEM_USER $AEM_DIR
RUN rm -f $AEM_DIR/$AEM_JAR

USER $AEM_USER
